#include <SPI.h>
#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>
#include "DHT.h"

// ---------- OLED SETTINGS ----------
#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64
#define OLED_RESET -1
#define SCREEN_ADDRESS 0x3C
Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, OLED_RESET);

// ---------- DHT11 SETTINGS ----------
#define DHTPIN 2
#define DHTTYPE DHT11
DHT dht(DHTPIN, DHTTYPE);

// ---------- BITMAPS ----------
static const unsigned char PROGMEM image_download_1_bits[] = {0x01,0x00,0x21,0x08,0x10,0x10,0x03,0x80,0x8c,0x62,0x48,0x24,0x10,0x10,0x10,0x10,0x10,0x10,0x48,0x24,0x8c,0x62,0x03,0x80,0x10,0x10,0x21,0x08,0x01,0x00,0x00,0x00};
static const unsigned char PROGMEM image_download_2_bits[] = {0x00,0x00,0x00,0x00,0x00,0x30,0x03,0x88,0x04,0x44,0x04,0x44,0x00,0x44,0x00,0x88,0xff,0x32,0x00,0x00,0xad,0x82,0x00,0x60,0x00,0x10,0x00,0x10,0x01,0x20,0x00,0xc0};
static const unsigned char PROGMEM image_download_3_bits[] = {0x04,0x00,0x04,0x00,0x0c,0x00,0x0e,0x00,0x1e,0x00,0x1f,0x00,0x3f,0x80,0x3f,0x80,0x7e,0xc0,0x7f,0x40,0xff,0x60,0xff,0xe0,0x7f,0xc0,0x7f,0xc0,0x3f,0x80,0x0f,0x00};
static const unsigned char PROGMEM image_download_4_bits[] = {0x1c,0x00,0x22,0x02,0x2b,0x05,0x2a,0x02,0x2b,0x38,0x2a,0x60,0x2b,0x40,0x2a,0x40,0x2a,0x60,0x49,0x38,0x9c,0x80,0xae,0x80,0xbe,0x80,0x9c,0x80,0x41,0x00,0x3e,0x00};
static const unsigned char PROGMEM image_download_bits[] = {0x00,0x00,0x80,0x00,0xcf,0x00,0xb6,0xf0,0xab,0x68,0xab,0x68,0x97,0xf0,0x9c,0x00,0xa0,0x00,0xc0,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x00,0x00};
static const unsigned char PROGMEM image_Layer_13_bits[] = {0x40,0xa0,0x40};


void setup() {
  display.begin(SSD1306_SWITCHCAPVCC, SCREEN_ADDRESS);
  dht.begin();
}

void loop() {

  int temp = dht.readTemperature();
  int hum = dht.readHumidity();

  // ---------- CHECK DHT READING ----------
  if (isnan(temp) || isnan(hum)) {
    display.clearDisplay();
    display.setCursor(0, 0);
    display.setTextColor(1);
    display.print("DHT ERROR!");
    display.display();
    delay(2000);
    return;
  }

  display.clearDisplay();

  display.setTextColor(1);
  display.setCursor(26, 7);
  display.print("Climate station");

  display.drawBitmap(10, 0, image_download_bits, 13, 16, 1);
  display.drawLine(0, 17, 127, 17, 1);

  display.drawBitmap(7, 21, image_download_1_bits, 15, 16, 1);
  display.drawBitmap(62, 21, image_download_2_bits, 15, 16, 1);
  display.drawBitmap(65, 44, image_download_3_bits, 11, 16, 1);
  display.drawBitmap(6, 44, image_download_4_bits, 16, 16, 1);

  display.setCursor(25, 25);
  display.print("Sunny");

  display.setCursor(26, 49);
  display.print(temp);
  display.print(" C");

  display.setCursor(82, 25);
  display.print("Windy");

  display.setCursor(82, 49);
  display.print(hum);
  display.print("%");

  display.drawBitmap(38, 47, image_Layer_13_bits, 3, 3, 1);
  display.display();

  delay(2000);  // DHT11 needs at least 2 sec
}
